// Generated by CoffeeScript 1.2.1-pre
(function() {
  var PageTitle, PageTitleList, PageTitleView, PageTitles, PageTitlesApp, PageTitlesView;

  PageTitle = Backbone.Model.extend({
    defaults: function() {
      return {
        title: "",
        selected: false
      };
    },
    initialize: function() {
      if (!this.get('title')) {
        this.set({
          'title': this.defaults.title
        });
      }
      return this.set('selected', this.defaults.selected);
    },
    clear: function() {
      return this.destroy();
    }
  });

  PageTitleList = Backbone.Collection.extend({
    model: PageTitle,
    url: ROOT + 'page_titles',
    selectFirst: function(args) {
      if (this.length > 0) return this.at(0).set('selected', true);
    },
    selectPage: function(model) {
      return this.each(function(m) {
        return m.set('selected', m.id === model.id);
      });
    }
  });

  PageTitles = new PageTitleList;

  PageTitleView = Backbone.View.extend({
    tagName: 'li',
    template: _.template('<a href="#"><%= title %></a>'),
    events: {
      'click': 'selectPage'
    },
    initialize: function() {
      this.model.bind('change', this.render, this);
      return this.model.bind('destroy', this.remove, this);
    },
    render: function() {
      this.$el.html(this.template(this.model.toJSON()));
      if (this.model.get('selected')) {
        return this.$el.addClass('active');
      } else {
        return this.$el.removeClass('active');
      }
    },
    selectPage: function() {
      return PageTitles.selectPage(this.model);
    }
  });

  PageTitlesView = Backbone.View.extend({
    initialize: function() {
      PageTitles.bind('reset', this.render, this);
      return PageTitles.fetch();
    },
    addOne: function(page_title) {
      var view;
      view = new PageTitleView({
        model: page_title
      });
      view.render();
      return this.$('#page-titles').append(view.el);
    },
    render: function() {
      this.$('#page-titles').empty();
      PageTitles.each(this.addOne);
      return PageTitles.selectFirst();
    }
  });

  PageTitlesApp = new PageTitlesView;

}).call(this);
