// Generated by CoffeeScript 1.2.1-pre
(function() {

  $(function() {
    var AppRouter, PageTitle, PageTitleList, PageTitleView, PageTitlesView, appRouter, pageTitles, pageTitlesApp;
    PageTitle = Backbone.Model.extend({
      defaults: function() {
        return {
          title: "",
          selected: false
        };
      },
      initialize: function() {
        if (!this.get('title')) {
          this.set({
            'title': this.defaults.title
          });
        }
        return this.set('selected', this.defaults.selected);
      },
      clear: function() {
        return this.destroy();
      }
    });
    PageTitleList = Backbone.Collection.extend({
      model: PageTitle,
      selectFirst: function() {
        if (this.length > 0) return this.at(0).set('selected', true);
      },
      selectPage: function(id) {
        return this.each(function(m) {
          return m.set('selected', m.id === id);
        });
      }
    });
    pageTitles = new PageTitleList;
    PageTitleView = Backbone.View.extend({
      tagName: 'li',
      template: _.template('<a href="#/pages/<%= id  %>"><%= title %></a>'),
      initialize: function() {
        this.model.bind('change', this.render, this);
        return this.model.bind('destroy', this.remove, this);
      },
      render: function() {
        this.$el.html(this.template(this.model.toJSON()));
        if (this.model.get('selected')) {
          return this.$el.addClass('active');
        } else {
          return this.$el.removeClass('active');
        }
      }
    });
    PageTitlesView = Backbone.View.extend({
      initialize: function() {
        return pageTitles.bind('reset', this.render, this);
      },
      addOne: function(page_title) {
        var view;
        view = new PageTitleView({
          model: page_title
        });
        view.render();
        return $('#page-titles').append(view.el);
      },
      render: function() {
        $('#page-titles').empty();
        return pageTitles.each(this.addOne);
      }
    });
    pageTitlesApp = new PageTitlesView;
    pageTitles.reset(gon.pageTitles);
    AppRouter = Backbone.Router.extend({
      routes: {
        'help': 'help',
        'pages/:id': 'getPage',
        '*actions': 'defaultRoute'
      },
      getPage: function(id) {
        return pageTitles.selectPage(parseInt(id));
      },
      defaultRoute: function(actions) {
        if (pageTitles.length > 0) return AppRouter.navigate('//pages/1');
      }
    });
    appRouter = new AppRouter;
    return Backbone.history.start();
  });

}).call(this);
